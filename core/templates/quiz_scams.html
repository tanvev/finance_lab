{% extends "base.html" %}
{% load static %}
{% block title %}Scams Quiz | Educational Finance Lab{% endblock %}

{% block extra_head %}
<style>
@keyframes fl-confetti-fall {
  0% { transform: translateY(-20px) rotate(0deg); opacity: 0; }
  20% { opacity: 1; }
  100% { transform: translateY(220px) rotate(360deg); opacity: 0; }
}
</style>

<script>
// -------------------------------
// 35-QUESTION MASTER BANK
// -------------------------------
const scamsBank = [
{ text:"SMS: 'Account frozen. Click http://secure-bank-verify.xyz'. You:", context:"", options:["Click & login","Call official bank number","Reply YES","Forward to friends"], correct:1, explanation:"Never click suspicious links. Call bank on official helpline." },
{ text:"Someone 'sent' you ₹1200 and asks you to return ₹1000. You:", context:"", options:["Return immediately","It may be a UPI return scam — verify first","Keep as gift","Give more"], correct:1, explanation:"Verify transactions before sending money back; attackers reverse later." },
{ text:"Job ad asks for registration fee via UPI. You:", context:"", options:["Pay","Don't pay — suspicious","Pay if small","Pay in cash"], correct:1, explanation:"Legit recruiters rarely ask upfront fees." },
{ text:"Email says 'you won prize, send PAN & bank to claim'. You:", context:"", options:["Send details","Verify via company site","Pay processing fee","Ignore"], correct:1, explanation:"Confirm through official channels; never share sensitive docs without verification." },
{ text:"Caller says 'we're bank risk team, give OTP to stop fraud'. You:", context:"", options:["Share OTP","Hang up & call bank official number","Share PIN","Share password"], correct:1, explanation:"Banks never ask for OTP/PIN by phone." },
{ text:"Loan app asks QR UPI 'processing fee' upfront. You:", context:"", options:["Pay","No — classic predatory / scam","Pay partial","Only if bank-certified"], correct:1, explanation:"Upfront UPI fee for loans is a red flag." },
{ text:"Email domain is 'tinyurl.xyz/claim', this implies:", context:"", options:["Safe","Probably a redirect to malicious site","Official bank","Government portal"], correct:1, explanation:"Short URLs hide real destination; avoid for banking." },
{ text:"You accidentally shared OTP; immediate action:", context:"", options:["Ignore","Call bank & block transactions","Share more details","Wait 24hrs"], correct:1, explanation:"Contact bank immediately to prevent loss." },
{ text:"Phishing email creates urgency. Safer response:", context:"", options:["Click link fast","Open official site manually and verify","Call number in email","Reply directly"], correct:1, explanation:"Always access site independently or call official support." },
{ text:"Recruiter asks for PAN + Aadhaar scan via gmail before interview. You:", context:"", options:["Send immediately","Ask for company portal or mask sensitive fields","Share via Whatsapp group","Ignore job"], correct:1, explanation:"Verify recruiter & use secure/company portals; mask details when possible." },

{ text:"Missed call then SMS asking to call back regarding UPI. You:", context:"", options:["Call back","Ignore & check bank app/statement first","Share OTP","Pay requested amount"], correct:1, explanation:"Common social-engineering trick — verify independently." },
{ text:"UPI 'accept then return' trick: best practice:", context:"", options:["Return immediately","Wait for bank confirmation & trace","Share OTP to speed up","Call their number to ask"], correct:1, explanation:"Don't return before verification — scammers manipulate timings." },
{ text:"Unsolicited KYC app link—should you install?", context:"", options:["Install quickly","Check official source and not install unknown app","Pay small fee","Install if reviews are good"], correct:1, explanation:"Only install apps from official stores and verified providers." },
{ text:"Someone asks 'confirm Aadhaar OTP'. You:", context:"", options:["Share OTP","Never share OTP","Share via email","Share with friend"], correct:1, explanation:"OTP is secret; never share." },
{ text:"QR payment request to unknown recipient for 'document clearance'. You:", context:"", options:["Pay now","Verify recipient & purpose first","Share OTP after scan","Assume it's government"], correct:1, explanation:"Always verify recipient identity before QR payments." },
{ text:"If you see mobile app with few reviews promising 'instant loans', most likely:", context:"", options:["Legit lender","Potential predatory app","Govt service","College project"], correct:1, explanation:"Many predatory apps misuse data & charge hidden fees." },
{ text:"Phishing phone call claims to be 'tax dept'. You:", context:"", options:["Share bank details","Check official tax portal & ignore call","Share Aadhar","Pay fine immediately"], correct:1, explanation:"Verify on official portals; tax departments don't call demanding immediate payments." },
{ text:"Fake job posting with gmail & poor grammar → action:", context:"", options:["Apply immediately","Treat as suspect & research company","Assume legit","Share widely"], correct:1, explanation:"Professional employers use company domains; investigate." },
{ text:"Someone asks to forward your UPI SMS for verification — you:", context:"", options:["Share freely","Ask why & avoid sharing OTP/secure codes","Also share OTP","Share bank ID"], correct:1, explanation:"Messages can contain sensitive info; verify reason." },
{ text:"A link domain ends with .xyz for 'bank verification' — you:", context:"", options:["Trust because it says 'secure'","Don't trust; check official bank domain","Trust if email contains bank logo","Call number in link"], correct:1, explanation:"Banks usually use known domains; .xyz is suspicious." },

{ text:"If someone pressures you to 'act now' for reward, correct step:", context:"", options:["Act quickly","Pause & verify via official channels","Pay a small registration fee","Send OTP"], correct:1, explanation:"Urgency is a classic manipulation; verify instead of reacting." },
{ text:"If an unknown caller asks to 'transfer money then await reversal', you should:", context:"", options:["Return right away","Refuse & verify with bank","Share OTP to speed up","Trust them"], correct:1, explanation:"Scammers use reversal illusions to trick you into sending funds." },
{ text:"Which is safer when receiving a message about bank issue?", context:"", options:["Click link in SMS","Open app or website yourself & check","Call number in SMS","Forward to friends"], correct:1, explanation:"Directly checking the official app/site avoids fake links." },
{ text:"If a 'support agent' asks for remote access to your phone, you should:", context:"", options:["Grant access","Refuse & contact official support","Share OTP","Install unknown app"], correct:1, explanation:"Never give remote access to unknown callers; contact official support instead." },
{ text:"If you see 'refund of INR X' but not credited in bank, next step:", context:"", options:["Trust and spend","Check statement & wait for official confirmation","Assume it's yours","Share OTP"], correct:1, explanation:"Always check bank statement / app for real confirmation." },

{ text:"WhatsApp messages asking for 'final verification' with link — do:", context:"", options:["Click link","Verify identity & use official channels","Pay via UPI link","Share OTP"], correct:1, explanation:"Avoid unfamiliar links on WhatsApp for financial tasks." },
{ text:"If you suspect fraud occurred, first action:", context:"", options:["Post on social","Block UPI & contact bank immediately","Wait a week","Try to reverse manually"], correct:1, explanation:"Block payments & contact bank ASAP to trace & stop further loss." },
{ text:"A person requests 'scan QR to receive and forward' as job test — cautious move:", context:"", options:["Do it for test","Decline & ask about test details","Share OTP as proof","Share bank details"], correct:1, explanation:"Ad-hoc QR payments are risky; ask for safer verification methods." },
{ text:"If you get a link claiming 'tax refund' ask:", context:"", options:["Send details immediately","Check official government portal","Click link to speed claim","Pay a fee"], correct:1, explanation:"Use official government portals for tax matters." },
{ text:"Which of these indicates a scammy website quickly?", context:"", options:["Poor grammar, odd domain, no contact address","Sleek design","High load speed","Many images"], correct:0, explanation:"Poor language and strange domains are common signals of low-quality/scam sites." },

{ text:"Fake 'loan waiver' sent via call — action:", context:"", options:["Click any received link","Verify via official lender channels first","Share OTP","Send personal details"], correct:1, explanation:"Verify such offers via official channels; don't click caller links." },
{ text:"If someone asks you to 'confirm last 4 digits of card' over SMS, you:", context:"", options:["Share immediately","Avoid sharing sensitive details unless verified","Give full PAN","Share CVV"], correct:1, explanation:"Confirm identity using safe channels; don't share sensitive card info casually." },
{ text:"If a message claims 'your account credited' but balance unchanged, you should:", context:"", options:["Return money","Contact bank and verify transaction","Share OTP","Ignore"], correct:1, explanation:"Contact bank to validate transaction, don't assume credited." },
{ text:"What is the best password habit to avoid fraud?", context:"", options:["Use unique strong passwords & 2FA, don't reuse OTPs","Use same password everywhere","Write OTPs on phone notes","Share PIN with spouse"], correct:0, explanation:"Unique passwords + 2FA protect against many common attacks." },
{ text:"If a recruiter demands money for 'background check', treat as:", context:"", options:["Normal","Red flag — verify company & avoid upfront fees","Good sign","Negligible"], correct:1, explanation:"Background fees being asked directly from candidate is suspicious." }
];


// -------------------------------
// Utility
// -------------------------------
function pickRandom5(arr) {
  return [...arr].sort(() => Math.random() - 0.5).slice(0, 5);
}

let quiz = [], idx = 0, score = 0, answered = {};

// -------------------------------
// Render Question
// -------------------------------
function renderQ() {
  const q = quiz[idx];

  document.getElementById("q-text").textContent = q.text;
  document.getElementById("q-counter").textContent = `Question ${idx+1} of ${quiz.length}`;
  document.getElementById("q-score").textContent = `Score: ${score} / ${quiz.length}`;

  const box = document.getElementById("q-options");
  box.innerHTML = "";
  document.getElementById("q-feedback").classList.add("hidden");
  document.getElementById("q-warning").classList.add("hidden");

  q.options.forEach((op,i)=>{
    const b=document.createElement("button");
    b.className="w-full text-left px-3 py-2 rounded-md border border-gray-200 dark:border-gray-600 text-sm bg-gray-50 dark:bg-gray-800 hover:bg-blue-50 dark:hover:bg-blue-900";
    b.textContent=op; b.onclick=()=>handle(i,b); box.appendChild(b);
  });

  document.getElementById("q-prev").disabled = idx === 0;

  if (answered[idx]) restoreState();
}

function restoreState() {
  const q = quiz[idx];
  const fb = document.getElementById("q-feedback");

  document.querySelectorAll("#q-options button").forEach((b,i)=>{
    b.disabled = true;
    if (i === q.correct) b.classList.add("bg-green-200");
  });

  fb.classList.remove("hidden");
  fb.innerHTML = `<strong>Answered</strong> – ${q.explanation}`;
}

// -------------------------------
// Handle Answer
// -------------------------------
function handle(i, btn) {
  if (answered[idx]) return;

  const q = quiz[idx];
  const buttons = document.querySelectorAll("#q-options button");

  buttons.forEach(b => b.disabled = true);

  const correct = i === q.correct;
  if (correct) { score++; btn.classList.add("bg-green-200"); }
  else { btn.classList.add("bg-red-200"); buttons[q.correct].classList.add("bg-green-200"); }

  document.getElementById("q-feedback").classList.remove("hidden");
  document.getElementById("q-feedback").innerHTML =
    `<strong>${correct ? "Correct" : "Incorrect"}</strong> – ${q.explanation}`;

  answered[idx] = true;
  document.getElementById("q-score").textContent = `Score: ${score} / ${quiz.length}`;
}

// -------------------------------
// Navigation
// -------------------------------
function nextQ(){
  if(!answered[idx])
    return document.getElementById("q-warning").classList.remove("hidden");

  if(idx === quiz.length-1) return showResult();
  idx++; renderQ();
}

function prevQ(){
  if(idx > 0){ idx--; renderQ(); }
}

// -------------------------------
// Results + XP + Badges
// -------------------------------
function showResult(){
  document.getElementById("quiz-card").classList.add("hidden");
  document.getElementById("result-card").classList.remove("hidden");

  const percent = Math.round((score / quiz.length) * 100);
  document.getElementById("result-score").textContent =
    `You scored ${score} / ${quiz.length} (${percent}%).`;

  let level = "bronze";
  if (percent > 70) level = "gold";
  else if (percent > 40) level = "silver";

  localStorage.setItem("fl_badge_scam", level);

  // XP: +50 base + bonus
  let xp = Number(localStorage.getItem("fl_xp") || 0);
  xp += 50 + (level === "silver" ? 10 : level === "gold" ? 20 : 0);
  localStorage.setItem("fl_xp", xp);

  renderBadge(level);
  launchConfetti();
}

function renderBadge(level){
  const wrap=document.getElementById("badge-wrapper");
  wrap.innerHTML = `
    <svg viewBox="0 0 120 150" class="w-28 h-36">
      <defs>
        <linearGradient id="ig" x1="0" y1="0" x2="0" y2="1">
          <stop offset="0%" stop-color="${level==="gold"?"#A9D957":level==="silver"?"#C9D1D9":"#C08A5B"}"/>
          <stop offset="100%" stop-color="${level==="gold"?"#6EA230":level==="silver"?"#8E99A8":"#8B5E3C"}"/>
        </linearGradient>
      </defs>
      <path d="M60 10 L95 25 L95 70 C95 95 80 120 60 135 C40 120 25 95 25 70 L25 25 Z"
        fill="url(#ig)" stroke="rgba(0,0,0,0.1)" stroke-width="2"/>
      <text x="60" y="95" text-anchor="middle" fill="white" font-size="14" font-weight="700">${level.toUpperCase()}</text>
    </svg>`;
}

function launchConfetti(){
  const c=document.getElementById("confetti-container");
  c.classList.remove("hidden");
  for(let i=0;i<40;i++){
    const p=document.createElement("div");
    p.style.cssText=
      `position:absolute;width:6px;height:3px;left:${Math.random()*100}%;
       top:-10px;background:#${Math.floor(Math.random()*999)};
       animation:fl-confetti-fall ${2+Math.random()}s ease-out forwards;`;
    c.appendChild(p);
  }
  setTimeout(()=>{c.innerHTML="";c.classList.add("hidden");},3000);
}

function restartQuiz(){
  idx=0;score=0;answered={};
  quiz=pickRandom5(scamsBank);
  document.getElementById("result-card").classList.add("hidden");
  document.getElementById("quiz-card").classList.remove("hidden");
  renderQ();
}

// -------------------------------
// INIT
// -------------------------------
document.addEventListener("DOMContentLoaded",()=>{
  quiz = pickRandom5(scamsBank);
  document.getElementById("q-next").onclick = nextQ;
  document.getElementById("q-prev").onclick = prevQ;
  renderQ();
});
</script>
{% endblock %}

{% block content %}

<section class="mb-6">
  <h1 class="text-2xl md:text-3xl font-semibold text-trust dark:text-blue-300">
    Scams Fundamentals – Quiz
  </h1>
  <p class="mt-2 text-sm md:text-base text-gray-700 dark:text-gray-300 max-w-2xl">
    Test your understanding of scams through calls, messages & UPI's.
    Every attempt gives 5 questions.
  </p>
</section>

{% include "quiz_base.html" %}

{% endblock %}
